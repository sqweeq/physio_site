{"ast":null,"code":"import _toConsumableArray from\"/Users/katie/Desktop/Brandon projects/physio_site/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/katie/Desktop/Brandon projects/physio_site/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/katie/Desktop/Brandon projects/physio_site/client/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/katie/Desktop/Brandon projects/physio_site/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/katie/Desktop/Brandon projects/physio_site/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/katie/Desktop/Brandon projects/physio_site/client/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{connect}from\"react-redux\";import{deleteItem,addItemToCart,getItems,addItem,getGuestCartItems,clearGuestCart,deleteGuestItem,clearUserCart}from\"../actions/itemActions\";import{Modal,Button}from\"bootstrap-4-react\";import{withRouter}from\"react-router-dom\";var CartModal=/*#__PURE__*/function(_Component){_inherits(CartModal,_Component);function CartModal(){var _getPrototypeOf2;var _this;_classCallCheck(this,CartModal);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(CartModal)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={itemsCleared:false};_this.componentDidMount=function(){_this.addGuestCartToUser();};_this.onClearUserCart=function(user,items){_this.props.clearUserCart(user,items);};_this.onClearGuestCart=function(){_this.props.clearGuestCart();};_this.deleteGuestCartItem=function(item){_this.props.deleteGuestItem(item);_this.props.getGuestCartItems();};return _this;}_createClass(CartModal,[{key:\"onClearItemsButton\",value:function onClearItemsButton(){var _this2=this;clearInterval(this.state.itemsCleared);this.setState({itemsCleared:true},function(){setInterval(function(){_this2.setState({itemsCleared:false});},5000);});}},{key:\"addGuestCartToUser\",value:function addGuestCartToUser(){this.props.getItems();var items=this.props.item.items;var user=this.props.auth.user;var isAuthenticated=this.props.auth.isAuthenticated;var existingGuestCart=JSON.parse(localStorage.getItem(\"guestCart\"));// added userID to guest cart items\nvar newItems=isAuthenticated&&existingGuestCart&&existingGuestCart.filter(function(item){if(item.userRefID!==user._id){item.userRefID=user._id;}return item;});var userLocalCompare=newItems&&newItems.filter(function(guestItem){return items.some(function(userItem){return userItem._id===guestItem._id&&guestItem.guestItemID!==userItem.guestItemID;});});// isAuthenticated && this.props.addItemToCart(userLocalCompare);\nconsole.log(userLocalCompare&&userLocalCompare.map(function(item){return item.guestItemID;}));console.log(items&&items.filter(function(item){return item.guestItemID!==undefined&&item.guestItemID;}).map(function(item){return item.guestItemID;}));}},{key:\"render\",value:function render(){var _this3=this;var items=this.props.item.items;var user=this.props.auth.user;var isAuthenticated=this.props.auth.isAuthenticated;var guestCart=this.props.item.guestCart;var deleteCartItem=function deleteCartItem(item){_this3.props.getItems();_this3.props.deleteItem(item._id);};var cartFilteredItems=isAuthenticated?items.filter(function(item){return item.userRefID!==\"\"&&item.userRefID===user._id;}):guestCart;var cartTotal=cartFilteredItems&&cartFilteredItems.reduce(function(prev,current){return prev+current.price;},0);var shippingCost=cartTotal&&cartTotal>100?0:7.99;var cartTotalTax=cartTotal&&cartTotal*0.15;var cartTotalWithTax=cartTotal&&cartTotal+cartTotalTax+shippingCost;var loggedCheckout=function loggedCheckout(){_this3.props.history.push({pathname:\"/payment\",state:cartTotalWithTax});};var guestCheckout=function guestCheckout(){_this3.props.history.push({pathname:\"/payment\",state:cartTotalWithTax});};var unique=_toConsumableArray(new Set(cartFilteredItems&&cartFilteredItems.map(function(item){return item.name;})));// const duplicateCart = unique.map(item => [\n//   item,\n//   unique.filter(str => str === item).length\n// ]);\nconsole.log(unique);// console.log(duplicateCart);\nreturn React.createElement(\"div\",null,React.createElement(Modal,{id:\"exampleModal\",fade:true},React.createElement(Modal.Dialog,{centered:true,className:\"m-auto\"},React.createElement(Modal.Content,null,React.createElement(Modal.Header,{className:\"p-3 border-dark\"},React.createElement(Modal.Title,{style:{textTransform:\"capitalize\"},className:\"float-left w-25 font-wieght-bolder\"},isAuthenticated?\"\".concat(user.name,\"'s Cart\"):\"Guest Cart\"),React.createElement(Modal.Close,{className:\"float-right modal-closing\"},React.createElement(\"span\",{\"aria-hidden\":\"true\",className:\"float-right mr-2\"},\"\\xD7\"))),React.createElement(\"div\",{className:\"py-3 w-75 mx-auto\"},React.createElement(\"h2\",null,\"My Bag\"),React.createElement(\"h5\",{className:\"m-3 mx-auto\"},\"Qty in cart:\",\" \",cartFilteredItems&&cartFilteredItems.length===null?0:cartFilteredItems&&cartFilteredItems.length),cartFilteredItems&&cartFilteredItems.map(function(item,i){return React.createElement(\"div\",{className:\"py-4 row border-top border-bottom border-secondary \",key:i},React.createElement(\"div\",{className:\"col-6 image-container m-auto\"},React.createElement(\"img\",{className:\"img-fluid center-block w-100 align-items-center\",src:item.productImage,alt:\"\"})),React.createElement(\"div\",{className:\"col-6 d-flex flex-column justify-content-between\"},React.createElement(\"h4\",{className:\"pb-3\"},item.name),React.createElement(\"p\",{className:\"pb-3\"},\"Description: \",item.description),React.createElement(\"p\",{className:\"pb-3\"},\"Price: $\",item.price),React.createElement(\"div\",{className:\"text-center\"},React.createElement(\"button\",{className:\"btn btn-primary w-50 p-2\",onClick:isAuthenticated?function(){return deleteCartItem(item);}:function(){return _this3.deleteGuestCartItem(item);}},\"Remove\"),React.createElement(\"div\",{className:\"m-3\"}))));})),React.createElement(\"button\",{type:\"button\",className:\"col-12 my-2 p-2 w-75 mx-auto mb-4 btn \"+(!this.state.itemsCleared?\"btn-info\":\"btn-success\"),onClick:isAuthenticated?function(){_this3.onClearUserCart(user,items);_this3.onClearItemsButton();}:function(){_this3.onClearGuestCart();_this3.onClearItemsButton();}},!this.state.itemsCleared?\"Reset Cart\":\"Cart Cleared!\"),React.createElement(Modal.Footer,{className:\"border-dark row px-5 py-3 \"},React.createElement(\"div\",{className:\"justify-content-center w-100\"},React.createElement(\"h5\",{className:\"pt-4 pb-2\"},\"Cart Total: \",cartTotal&&cartTotal.toFixed(2)),React.createElement(\"h5\",{className:\" pt-2 pb-2\"},\"Shipping & Handling:\",\" \",cartTotal>100?\"FREE\":cartTotal===0?\"0\":shippingCost),React.createElement(\"h5\",{className:\"pt-2 pb-3\"},\"Tax: \",cartTotalTax&&cartTotalTax.toFixed(2))),React.createElement(\"h3\",{className:\"font-weight-bolder border-top border-secondary py-4 w-100\"},\"Order total (\",cartFilteredItems&&cartFilteredItems.length,\" \",\"item): $\",cartTotalWithTax&&cartTotalWithTax.toFixed(2)),React.createElement(Button,{className:\"col-12 my-1 p-2 my-3\",secondary:true,\"data-dismiss\":\"modal\"},\"Close cart\"),React.createElement(Button,{\"data-dismiss\":\"modal\",className:\"btn btn-primary btn-danger col-12 mt-2 mb-4 w-25 p-2\",onClick:isAuthenticated?function(){return loggedCheckout(cartTotalWithTax);}:function(){return guestCheckout(cartTotalWithTax);}},\"PROCEED TO CHECKOUT\"))))));}}]);return CartModal;}(Component);var mapStateToProps=function mapStateToProps(state){return{item:state.item,auth:state.auth};};export default connect(mapStateToProps,{deleteItem:deleteItem,addItemToCart:addItemToCart,addItem:addItem,getItems:getItems,getGuestCartItems:getGuestCartItems,clearGuestCart:clearGuestCart,deleteGuestItem:deleteGuestItem,clearUserCart:clearUserCart})(withRouter(CartModal));","map":{"version":3,"sources":["/Users/katie/Desktop/Brandon projects/physio_site/client/src/components/CartModal.js"],"names":["React","Component","connect","deleteItem","addItemToCart","getItems","addItem","getGuestCartItems","clearGuestCart","deleteGuestItem","clearUserCart","Modal","Button","withRouter","CartModal","state","itemsCleared","componentDidMount","addGuestCartToUser","onClearUserCart","user","items","props","onClearGuestCart","deleteGuestCartItem","item","clearInterval","setState","setInterval","auth","isAuthenticated","existingGuestCart","JSON","parse","localStorage","getItem","newItems","filter","userRefID","_id","userLocalCompare","guestItem","some","userItem","guestItemID","console","log","map","undefined","guestCart","deleteCartItem","cartFilteredItems","cartTotal","reduce","prev","current","price","shippingCost","cartTotalTax","cartTotalWithTax","loggedCheckout","history","push","pathname","guestCheckout","unique","Set","name","textTransform","length","i","productImage","description","onClearItemsButton","toFixed","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport {\n  deleteItem,\n  addItemToCart,\n  getItems,\n  addItem,\n  getGuestCartItems,\n  clearGuestCart,\n  deleteGuestItem,\n  clearUserCart\n} from \"../actions/itemActions\";\nimport { Modal, Button } from \"bootstrap-4-react\";\nimport { withRouter } from \"react-router-dom\";\nclass CartModal extends Component {\n  state = {\n    itemsCleared: false\n  };\n\n  onClearItemsButton() {\n    clearInterval(this.state.itemsCleared);\n    this.setState(\n      {\n        itemsCleared: true\n      },\n      () => {\n        setInterval(() => {\n          this.setState({\n            itemsCleared: false\n          });\n        }, 5000);\n      }\n    );\n  }\n  componentDidMount = () => {\n    this.addGuestCartToUser();\n  };\n\n  onClearUserCart = (user, items) => {\n    this.props.clearUserCart(user, items);\n  };\n\n  onClearGuestCart = () => {\n    this.props.clearGuestCart();\n  };\n  deleteGuestCartItem = item => {\n    this.props.deleteGuestItem(item);\n    this.props.getGuestCartItems();\n  };\n  addGuestCartToUser() {\n    this.props.getItems();\n    const { items } = this.props.item;\n    const { user } = this.props.auth;\n    const { isAuthenticated } = this.props.auth;\n    let existingGuestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n\n    // added userID to guest cart items\n    let newItems =\n      isAuthenticated &&\n      existingGuestCart &&\n      existingGuestCart.filter(item => {\n        if (item.userRefID !== user._id) {\n          item.userRefID = user._id;\n        }\n        return item;\n      });\n    let userLocalCompare =\n      newItems &&\n      newItems.filter(guestItem => {\n        return items.some(userItem => {\n          return (\n            userItem._id === guestItem._id &&\n            guestItem.guestItemID !== userItem.guestItemID\n          );\n        });\n      });\n\n    // isAuthenticated && this.props.addItemToCart(userLocalCompare);\n    console.log(\n      userLocalCompare && userLocalCompare.map(item => item.guestItemID)\n    );\n\n    console.log(\n      items &&\n        items\n          .filter(item => item.guestItemID !== undefined && item.guestItemID)\n          .map(item => item.guestItemID)\n    );\n  }\n\n  render() {\n    const { items } = this.props.item;\n    const { user } = this.props.auth;\n    const { isAuthenticated } = this.props.auth;\n    const { guestCart } = this.props.item;\n\n    const deleteCartItem = item => {\n      this.props.getItems();\n      this.props.deleteItem(item._id);\n    };\n\n    let cartFilteredItems = isAuthenticated\n      ? items.filter(\n          item => item.userRefID !== \"\" && item.userRefID === user._id\n        )\n      : guestCart;\n\n    let cartTotal =\n      cartFilteredItems &&\n      cartFilteredItems.reduce((prev, current) => prev + current.price, 0);\n    let shippingCost = cartTotal && cartTotal > 100 ? 0 : 7.99;\n    let cartTotalTax = cartTotal && cartTotal * 0.15;\n    let cartTotalWithTax = cartTotal && cartTotal + cartTotalTax + shippingCost;\n\n    const loggedCheckout = () => {\n      this.props.history.push({\n        pathname: \"/payment\",\n        state: cartTotalWithTax\n      });\n    };\n\n    const guestCheckout = () => {\n      this.props.history.push({\n        pathname: \"/payment\",\n        state: cartTotalWithTax\n      });\n    };\n    let unique = [\n      ...new Set(cartFilteredItems && cartFilteredItems.map(item => item.name))\n    ];\n    // const duplicateCart = unique.map(item => [\n    //   item,\n    //   unique.filter(str => str === item).length\n    // ]);\n    console.log(unique);\n    // console.log(duplicateCart);\n\n    return (\n      <div>\n        <Modal id=\"exampleModal\" fade>\n          <Modal.Dialog centered className=\"m-auto\">\n            <Modal.Content>\n              <Modal.Header className=\"p-3 border-dark\">\n                <Modal.Title\n                  style={{ textTransform: \"capitalize\" }}\n                  className=\"float-left w-25 font-wieght-bolder\"\n                >\n                  {isAuthenticated ? `${user.name}'s Cart` : \"Guest Cart\"}\n                </Modal.Title>\n                <Modal.Close className=\"float-right modal-closing\">\n                  <span aria-hidden=\"true\" className=\"float-right mr-2\">\n                    &times;\n                  </span>\n                </Modal.Close>\n              </Modal.Header>\n\n              <div className=\"py-3 w-75 mx-auto\">\n                <h2>My Bag</h2>\n                <h5 className=\"m-3 mx-auto\">\n                  Qty in cart:{\" \"}\n                  {cartFilteredItems && cartFilteredItems.length === null\n                    ? 0\n                    : cartFilteredItems && cartFilteredItems.length}\n                </h5>\n\n                {cartFilteredItems &&\n                  cartFilteredItems.map((item, i) => (\n                    <div\n                      className=\"py-4 row border-top border-bottom border-secondary \"\n                      key={i}\n                    >\n                      <div className=\"col-6 image-container m-auto\">\n                        <img\n                          className=\"img-fluid center-block w-100 align-items-center\"\n                          src={item.productImage}\n                          alt=\"\"\n                        />\n                      </div>\n                      <div className=\"col-6 d-flex flex-column justify-content-between\">\n                        {/* <p>{i}</p> */}\n                        {/* <h5>GuestID: {item.guestItemID && item.guestItemID}</h5> */}\n                        <h4 className=\"pb-3\">{item.name}</h4>\n                        <p className=\"pb-3\">Description: {item.description}</p>\n\n                        {/* <p>Category: {item.category}</p> */}\n                        <p className=\"pb-3\">Price: ${item.price}</p>\n                        <div className=\"text-center\">\n                          <button\n                            className=\"btn btn-primary w-50 p-2\"\n                            onClick={\n                              isAuthenticated\n                                ? () => deleteCartItem(item)\n                                : () => this.deleteGuestCartItem(item)\n                            }\n                          >\n                            Remove\n                          </button>\n\n                          <div className=\"m-3\"></div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n              </div>\n\n              <button\n                type=\"button\"\n                className={\n                  \"col-12 my-2 p-2 w-75 mx-auto mb-4 btn \" +\n                  (!this.state.itemsCleared ? \"btn-info\" : \"btn-success\")\n                }\n                onClick={\n                  isAuthenticated\n                    ? () => {\n                        this.onClearUserCart(user, items);\n                        this.onClearItemsButton();\n                      }\n                    : () => {\n                        this.onClearGuestCart();\n                        this.onClearItemsButton();\n                      }\n                }\n              >\n                {!this.state.itemsCleared ? \"Reset Cart\" : \"Cart Cleared!\"}\n              </button>\n\n              <Modal.Footer className=\"border-dark row px-5 py-3 \">\n                <div className=\"justify-content-center w-100\">\n                  <h5 className=\"pt-4 pb-2\">\n                    Cart Total: {cartTotal && cartTotal.toFixed(2)}\n                  </h5>\n                  <h5 className=\" pt-2 pb-2\">\n                    Shipping & Handling:{\" \"}\n                    {cartTotal > 100\n                      ? \"FREE\"\n                      : cartTotal === 0\n                      ? \"0\"\n                      : shippingCost}\n                  </h5>\n                  <h5 className=\"pt-2 pb-3\">\n                    Tax: {cartTotalTax && cartTotalTax.toFixed(2)}\n                  </h5>\n                </div>\n\n                <h3 className=\"font-weight-bolder border-top border-secondary py-4 w-100\">\n                  Order total ({cartFilteredItems && cartFilteredItems.length}{\" \"}\n                  item): ${cartTotalWithTax && cartTotalWithTax.toFixed(2)}\n                </h3>\n\n                <Button\n                  className=\"col-12 my-1 p-2 my-3\"\n                  secondary\n                  data-dismiss=\"modal\"\n                >\n                  Close cart\n                </Button>\n\n                <Button\n                  data-dismiss=\"modal\"\n                  className=\"btn btn-primary btn-danger col-12 mt-2 mb-4 w-25 p-2\"\n                  onClick={\n                    isAuthenticated\n                      ? () => loggedCheckout(cartTotalWithTax)\n                      : () => guestCheckout(cartTotalWithTax)\n                  }\n                >\n                  PROCEED TO CHECKOUT\n                </Button>\n              </Modal.Footer>\n            </Modal.Content>\n          </Modal.Dialog>\n        </Modal>\n      </div>\n    );\n  }\n}\nconst mapStateToProps = state => ({\n  item: state.item,\n  auth: state.auth\n});\nexport default connect(mapStateToProps, {\n  deleteItem,\n  addItemToCart,\n  addItem,\n  getItems,\n  getGuestCartItems,\n  clearGuestCart,\n  deleteGuestItem,\n  clearUserCart\n})(withRouter(CartModal));\n"]},"metadata":{},"sourceType":"module"}