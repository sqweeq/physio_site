{"ast":null,"code":"var _jsxFileName = \"/Users/katie/Desktop/Brandon projects/physio_site/client/src/components/CartModal.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { deleteItem, addItemToCart, getItems, addItem, getGuestCartItems, clearGuestCart, deleteGuestItem, clearUserCart // loadLocalToUser,\n} from \"../actions/itemActions\";\nimport { Modal, Button } from \"bootstrap-4-react\";\nimport { withRouter } from \"react-router-dom\";\n\nclass CartModal extends Component {\n  constructor(...args) {\n    super(...args);\n\n    this.onClearUserCart = (user, items) => {\n      this.props.clearUserCart(user, items); // this.props.getItems();\n    };\n\n    this.onClearGuestCart = () => {\n      this.props.clearGuestCart();\n    };\n\n    this.deleteGuestCartItem = item => {\n      console.log(item.guestItemID);\n      this.props.deleteGuestItem(item);\n      this.props.getGuestCartItems();\n    };\n  }\n\n  // componentDidMount() {\n  //   this.props.getItems();\n  //   this.props.getGuestCartItems();\n  //   // this.props.loadLocalToUser();\n  // }\n  componentDidMount() {\n    this.addGuestCartToUser();\n  }\n\n  addGuestCartToUser() {\n    this.props.getItems();\n    const items = this.props.item.items;\n    const user = this.props.auth.user;\n    const isAuthenticated = this.props.auth.isAuthenticated;\n    let existingGuestCart = JSON.parse(localStorage.getItem(\"guestCart\")); // added userID to guest cart items\n\n    let newItems = isAuthenticated && existingGuestCart && existingGuestCart.filter(item => {\n      if (item.userRefID !== user._id) {\n        item.userRefID = user._id;\n      }\n\n      return item;\n    });\n    let userLocalCompare = newItems && newItems.filter(guestItem => {\n      return items.some(userItem => userItem._id === guestItem._id && guestItem.guestItemID !== userItem.guestItemID);\n    });\n    this.props.getItems();\n    console.log(newItems && newItems.map(item => item.userRefID && item.userRefID)); // console.log(\n    //   userLocalCompare && userLocalCompare.map(item => item.guestItemID)\n    // );\n\n    console.log(items && items.map(item => item.guestItemID)); // this.props.addItemToCart(userLocalCompare);\n  } // checkLocalAndDB = () => {\n  //   const { isAuthenticated } = this.props.auth;\n  //   const { user } = this.props.auth;\n  //   if (isAuthenticated) {\n  //     let existingGuestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n  //     const newItems = existingGuestCart.map(item => {\n  //       item.userRefID === user._id ? item : item.userRefID === user._id;\n  //     });\n  //     console.log(newItems);\n  //   }\n  // };\n\n\n  render() {\n    const items = this.props.item.items;\n    const user = this.props.auth.user;\n    const isAuthenticated = this.props.auth.isAuthenticated;\n    const guestCart = this.props.item.guestCart; // addGuestToUser = () => {\n    // this.componentDidMount = () => {\n    //   addGuestCartToUser();\n    // };\n    // const addGuestCartToUser = () => {\n    // };\n\n    const deleteCartItem = item => {\n      this.props.getItems();\n      this.props.deleteItem(item._id);\n      console.log(item);\n    };\n\n    let cartFilteredItems = isAuthenticated ? items.filter(item => item.userRefID !== \"\" && item.userRefID === user._id) : guestCart;\n    let cartTotal = cartFilteredItems && cartFilteredItems.reduce((prev, current) => prev + current.price, 0);\n    let shippingCost = cartTotal && cartTotal > 100 ? 0 : 7.99;\n    let cartTotalTax = cartTotal && cartTotal * 0.15;\n    let cartTotalWithTax = cartTotal && cartTotal + cartTotalTax + shippingCost; // console.log(cartTotalTax);\n    // console.log(cartTotalWithTax);\n\n    const loggedCheckout = () => {\n      this.props.history.push({\n        pathname: \"/shop/payment\",\n        state: cartTotalWithTax\n      });\n    }; // console.log(existingGuestCart);\n\n\n    const guestCheckout = () => {\n      this.props.history.push({\n        pathname: \"/register\"\n      });\n    };\n\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, React.createElement(Modal, {\n      id: \"exampleModal\",\n      fade: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, React.createElement(Modal.Dialog, {\n      centered: true,\n      className: \"m-auto\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, React.createElement(Modal.Content, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, React.createElement(Modal.Header, {\n      className: \"p-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, React.createElement(Modal.Title, {\n      style: {\n        textTransform: \"capitalize\"\n      },\n      className: \"float-left w-25 font-wieght-bolder\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, isAuthenticated ? `${user.name}'s Cart` : \"Guest Cart\"), React.createElement(Modal.Close, {\n      className: \"float-right w-25\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      \"aria-hidden\": \"true\",\n      className: \"float-right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    }, \"\\xD7\"))), React.createElement(\"div\", {\n      className: \"p-3 w-75 mx-auto\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, \"Items\"), React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, \"Qty in cart:\", \" \", cartFilteredItems && cartFilteredItems.length === null ? 0 : cartFilteredItems && cartFilteredItems.length), cartFilteredItems && cartFilteredItems.map((item, i) => // item.userRefID === user._id ?\n    React.createElement(\"div\", {\n      className: \"card p-4\",\n      key: i,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, i), React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }, \"GuestID: \", item.guestItemID && item.guestItemID), React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, \"Name: \", item.name), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }, \"Description: \", item.description), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, \"Category: \", item.category), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, \"Price: $\", item.price), React.createElement(\"div\", {\n      className: \"image-container mx-auto\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: \"img-fluid img-thumbnail center-block\",\n      src: item.productImage,\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"row d-flex justify-content-center align-content-end pt-5 h-25\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"btn btn-primary w-50 p-2\",\n      onClick: isAuthenticated ? () => deleteCartItem(item) : () => this.deleteGuestCartItem(item),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    }, \"Remove\"), React.createElement(\"div\", {\n      className: \"m-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }))))), React.createElement(Button, {\n      className: \"col-12 my-1 w-25 p-2\",\n      secondary: true,\n      onClick: isAuthenticated ? () => this.onClearUserCart(user, items) : () => this.onClearGuestCart(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }, \"Clear Cart\"), React.createElement(Modal.Footer, {\n      className: \"border-dark row px-5 py-3 \",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }, React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221\n      },\n      __self: this\n    }, \"Cart Total: \", cartTotal && cartTotal.toFixed(2)), React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, \"Shipping & Handling:\", \" \", shippingCost === 0 || cartTotal === 0 ? \"FREE\" : shippingCost), React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }, \"Tax: \", cartTotalTax && cartTotalTax.toFixed(2)), React.createElement(\"h3\", {\n      className: \"font-weight-bolder border-top\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, \"Order total (\", cartFilteredItems && cartFilteredItems.length, \" \", \"item): $\", cartTotalWithTax && cartTotalWithTax.toFixed(2)), React.createElement(Button, {\n      className: \"col-12 my-1 w-25 p-2\",\n      secondary: true,\n      \"data-dismiss\": \"modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, \"Close cart\"), React.createElement(Button, {\n      \"data-dismiss\": \"modal\",\n      className: \"btn btn-primary btn-danger col-12 my-1 w-25 p-2\" // to={{\n      //   pathname: \"/shop/payment\",\n      //   state: cartTotalWithTax\n      // }}\n      // replace\n      ,\n      onClick: isAuthenticated ? () => loggedCheckout(cartTotalWithTax) : () => guestCheckout(cartTotalWithTax),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, \"CHECKOUT\"))))));\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  item: state.item,\n  auth: state.auth\n});\n\nexport default connect(mapStateToProps, {\n  deleteItem,\n  addItemToCart,\n  addItem,\n  getItems,\n  getGuestCartItems,\n  clearGuestCart,\n  deleteGuestItem,\n  clearUserCart // loadLocalToUser,\n\n})(withRouter(CartModal));","map":{"version":3,"sources":["/Users/katie/Desktop/Brandon projects/physio_site/client/src/components/CartModal.js"],"names":["React","Component","connect","deleteItem","addItemToCart","getItems","addItem","getGuestCartItems","clearGuestCart","deleteGuestItem","clearUserCart","Modal","Button","withRouter","CartModal","onClearUserCart","user","items","props","onClearGuestCart","deleteGuestCartItem","item","console","log","guestItemID","componentDidMount","addGuestCartToUser","auth","isAuthenticated","existingGuestCart","JSON","parse","localStorage","getItem","newItems","filter","userRefID","_id","userLocalCompare","guestItem","some","userItem","map","render","guestCart","deleteCartItem","cartFilteredItems","cartTotal","reduce","prev","current","price","shippingCost","cartTotalTax","cartTotalWithTax","loggedCheckout","history","push","pathname","state","guestCheckout","textTransform","name","length","i","description","category","productImage","toFixed","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport {\n  deleteItem,\n  addItemToCart,\n  getItems,\n  addItem,\n  getGuestCartItems,\n  clearGuestCart,\n  deleteGuestItem,\n  clearUserCart\n  // loadLocalToUser,\n} from \"../actions/itemActions\";\nimport { Modal, Button } from \"bootstrap-4-react\";\n\nimport { withRouter } from \"react-router-dom\";\nclass CartModal extends Component {\n  // componentDidMount() {\n  //   this.props.getItems();\n  //   this.props.getGuestCartItems();\n\n  //   // this.props.loadLocalToUser();\n  // }\n  componentDidMount() {\n    this.addGuestCartToUser();\n  }\n\n  onClearUserCart = (user, items) => {\n    this.props.clearUserCart(user, items);\n    // this.props.getItems();\n  };\n\n  onClearGuestCart = () => {\n    this.props.clearGuestCart();\n  };\n  deleteGuestCartItem = item => {\n    console.log(item.guestItemID);\n\n    this.props.deleteGuestItem(item);\n    this.props.getGuestCartItems();\n  };\n  addGuestCartToUser() {\n    this.props.getItems();\n    const { items } = this.props.item;\n    const { user } = this.props.auth;\n    const { isAuthenticated } = this.props.auth;\n    let existingGuestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n\n    // added userID to guest cart items\n    let newItems =\n      isAuthenticated &&\n      existingGuestCart &&\n      existingGuestCart.filter(item => {\n        if (item.userRefID !== user._id) {\n          item.userRefID = user._id;\n        }\n        return item;\n      });\n    let userLocalCompare =\n      newItems &&\n      newItems.filter(guestItem => {\n        return items.some(\n          userItem =>\n            userItem._id === guestItem._id &&\n            guestItem.guestItemID !== userItem.guestItemID\n        );\n      });\n\n    this.props.getItems();\n    console.log(\n      newItems && newItems.map(item => item.userRefID && item.userRefID)\n    );\n\n    // console.log(\n    //   userLocalCompare && userLocalCompare.map(item => item.guestItemID)\n    // );\n    console.log(items && items.map(item => item.guestItemID));\n\n    // this.props.addItemToCart(userLocalCompare);\n  }\n  // checkLocalAndDB = () => {\n  //   const { isAuthenticated } = this.props.auth;\n  //   const { user } = this.props.auth;\n\n  //   if (isAuthenticated) {\n  //     let existingGuestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n\n  //     const newItems = existingGuestCart.map(item => {\n  //       item.userRefID === user._id ? item : item.userRefID === user._id;\n  //     });\n  //     console.log(newItems);\n  //   }\n  // };\n  render() {\n    const { items } = this.props.item;\n    const { user } = this.props.auth;\n    const { isAuthenticated } = this.props.auth;\n    const { guestCart } = this.props.item;\n\n    // addGuestToUser = () => {\n\n    // this.componentDidMount = () => {\n    //   addGuestCartToUser();\n    // };\n\n    // const addGuestCartToUser = () => {\n\n    // };\n    const deleteCartItem = item => {\n      this.props.getItems();\n      this.props.deleteItem(item._id);\n      console.log(item);\n    };\n\n    let cartFilteredItems = isAuthenticated\n      ? items.filter(\n          item => item.userRefID !== \"\" && item.userRefID === user._id\n        )\n      : guestCart;\n\n    let cartTotal =\n      cartFilteredItems &&\n      cartFilteredItems.reduce((prev, current) => prev + current.price, 0);\n    let shippingCost = cartTotal && cartTotal > 100 ? 0 : 7.99;\n    let cartTotalTax = cartTotal && cartTotal * 0.15;\n    let cartTotalWithTax = cartTotal && cartTotal + cartTotalTax + shippingCost;\n    // console.log(cartTotalTax);\n    // console.log(cartTotalWithTax);\n    const loggedCheckout = () => {\n      this.props.history.push({\n        pathname: \"/shop/payment\",\n        state: cartTotalWithTax\n      });\n    };\n    // console.log(existingGuestCart);\n    const guestCheckout = () => {\n      this.props.history.push({\n        pathname: \"/register\"\n      });\n    };\n    return (\n      <div>\n        <Modal id=\"exampleModal\" fade>\n          <Modal.Dialog centered className=\"m-auto\">\n            <Modal.Content>\n              <Modal.Header className=\"p-3\">\n                <Modal.Title\n                  style={{ textTransform: \"capitalize\" }}\n                  className=\"float-left w-25 font-wieght-bolder\"\n                >\n                  {isAuthenticated ? `${user.name}'s Cart` : \"Guest Cart\"}\n                </Modal.Title>\n                <Modal.Close className=\"float-right w-25\">\n                  <span aria-hidden=\"true\" className=\"float-right\">\n                    &times;\n                  </span>\n                </Modal.Close>\n              </Modal.Header>\n\n              <div className=\"p-3 w-75 mx-auto\">\n                <h2>Items</h2>\n                <h4>\n                  Qty in cart:{\" \"}\n                  {cartFilteredItems && cartFilteredItems.length === null\n                    ? 0\n                    : cartFilteredItems && cartFilteredItems.length}\n                </h4>\n                {/* {items &&\n                  items */}\n\n                {cartFilteredItems &&\n                  cartFilteredItems.map((item, i) => (\n                    // item.userRefID === user._id ?\n                    <div className=\"card p-4\" key={i}>\n                      <p>{i}</p>\n                      <h5>GuestID: {item.guestItemID && item.guestItemID}</h5>\n                      <h5>Name: {item.name}</h5>\n                      <p>Description: {item.description}</p>\n                      <p>Category: {item.category}</p>\n                      <p>Price: ${item.price}</p>\n                      <div className=\"image-container mx-auto\">\n                        <img\n                          className=\"img-fluid img-thumbnail center-block\"\n                          src={item.productImage}\n                          alt=\"\"\n                        />\n                      </div>\n\n                      <div className=\"row d-flex justify-content-center align-content-end pt-5 h-25\">\n                        <button\n                          className=\"btn btn-primary w-50 p-2\"\n                          onClick={\n                            isAuthenticated\n                              ? () => deleteCartItem(item)\n                              : () => this.deleteGuestCartItem(item)\n                          }\n                        >\n                          Remove\n                        </button>\n\n                        <div className=\"m-3\"></div>\n                      </div>\n                    </div>\n                  ))}\n              </div>\n\n              <Button\n                className=\"col-12 my-1 w-25 p-2\"\n                secondary\n                onClick={\n                  isAuthenticated\n                    ? () => this.onClearUserCart(user, items)\n                    : () => this.onClearGuestCart()\n                }\n              >\n                Clear Cart\n              </Button>\n\n              {/* {guestCart && guestCart.map(item => <div>{item.name}</div>)} */}\n              <Modal.Footer className=\"border-dark row px-5 py-3 \">\n                <h5>Cart Total: {cartTotal && cartTotal.toFixed(2)}</h5>\n                <h5>\n                  Shipping & Handling:{\" \"}\n                  {shippingCost === 0 || cartTotal === 0\n                    ? \"FREE\"\n                    : shippingCost}\n                </h5>\n                <h5>Tax: {cartTotalTax && cartTotalTax.toFixed(2)}</h5>\n                <h3 className=\"font-weight-bolder border-top\">\n                  Order total ({cartFilteredItems && cartFilteredItems.length}{\" \"}\n                  item): ${cartTotalWithTax && cartTotalWithTax.toFixed(2)}\n                </h3>\n                <Button\n                  className=\"col-12 my-1 w-25 p-2\"\n                  secondary\n                  data-dismiss=\"modal\"\n                >\n                  Close cart\n                </Button>\n                <Button\n                  data-dismiss=\"modal\"\n                  className=\"btn btn-primary btn-danger col-12 my-1 w-25 p-2\"\n                  // to={{\n                  //   pathname: \"/shop/payment\",\n                  //   state: cartTotalWithTax\n                  // }}\n                  // replace\n                  onClick={\n                    isAuthenticated\n                      ? () => loggedCheckout(cartTotalWithTax)\n                      : () => guestCheckout(cartTotalWithTax)\n                  }\n                >\n                  CHECKOUT\n                </Button>\n              </Modal.Footer>\n            </Modal.Content>\n          </Modal.Dialog>\n        </Modal>\n      </div>\n    );\n  }\n}\nconst mapStateToProps = state => ({\n  item: state.item,\n  auth: state.auth\n});\nexport default connect(mapStateToProps, {\n  deleteItem,\n  addItemToCart,\n  addItem,\n  getItems,\n  getGuestCartItems,\n  clearGuestCart,\n  deleteGuestItem,\n  clearUserCart\n  // loadLocalToUser,\n})(withRouter(CartModal));\n"]},"metadata":{},"sourceType":"module"}